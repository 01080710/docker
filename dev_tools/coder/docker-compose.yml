services:
  # ğŸ” Nginx Proxyï¼šè‡ªå‹•æ ¹æ“šå®¹å™¨çš„ VIRTUAL_HOST è¨­å®šåå‘ä»£ç†
  nginx-proxy:
    image: jwilder/nginx-proxy
    container_name: nginx-proxy
    restart: always
    ports:
      - "8088:80"     # å°å¤–é–‹æ”¾ HTTP
      - "4443:443"   # å°å¤–é–‹æ”¾ HTTPS
    volumes:
      # æ›è¼‰ Docker socketï¼Œè®“ nginx-proxy å¯ä»¥ç›£è½å…¶ä»–å®¹å™¨çš„è®ŠåŒ–
      - /var/run/docker.sock:/tmp/docker.sock:ro
      # æ†‘è­‰å„²å­˜ä½ç½®
      - ./certs:/etc/nginx/certs
      # æ¯å€‹ç¶²ç«™è™›æ“¬ä¸»æ©Ÿè¨­å®š
      - ./vhost.d:/etc/nginx/vhost.d
      # é è¨­çš„éœæ…‹è³‡æºé é¢
      - ./html:/usr/share/nginx/html

  # ğŸ”’ Let's Encrypt Companionï¼šè‡ªå‹•ç”³è«‹èˆ‡çºŒæœŸ SSL æ†‘è­‰
  letsencrypt:
    image: jrcs/letsencrypt-nginx-proxy-companion
    container_name: nginx-letsencrypt
    restart: always
    environment:
      - NGINX_PROXY_CONTAINER=nginx-proxy  # å‘Šè¨´ companion è¦æ¥å“ªå€‹ nginx-proxy
      - DEFAULT_EMAIL=zxcvbnm951654@kimo.com      # æ†‘è­‰éæœŸé€šçŸ¥ç”¨çš„ Emailï¼ˆè«‹æ”¹æˆä½ è‡ªå·±çš„ï¼‰
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./certs:/etc/nginx/certs
      - ./vhost.d:/etc/nginx/vhost.d
      - ./html:/usr/share/nginx/html

  # ğŸ’» code-server å®¹å™¨ï¼šå°‡ VS Code æœå‹™åŒ–ã€åŠ å¯†ã€æä¾›é ç«¯å­˜å–
  code-server:
    image: codercom/code-server:latest
    container_name: code-server
    restart: always
    user: root           # ä½¿ç”¨ root é¿å…æ¬Šé™å•é¡Œï¼ˆæ³¨æ„å®‰å…¨æ€§ï¼‰
    privileged: true     # å•Ÿç”¨å®¹å™¨çš„å®Œå…¨æ¬Šé™ï¼ˆå¯é¸ï¼‰
    environment:
      - PASSWORD=123456                        # ç™»å…¥ code-server æ™‚çš„å¯†ç¢¼ï¼ˆè«‹æ”¹æ‰ï¼‰
      - VIRTUAL_HOST=yourdomain.com           # æä¾›çµ¦ nginx-proxy ä½¿ç”¨çš„ä¸»æ©Ÿåç¨±
      - LETSENCRYPT_HOST=yourdomain.com       # æŒ‡å®šç”³è«‹æ†‘è­‰çš„ç¶²åŸŸ
      - LETSENCRYPT_EMAIL=zxcvbnm951654@kimo.com     # æ†‘è­‰é€šçŸ¥ Emailï¼ˆè¦æ”¹æˆä½ è‡ªå·±çš„ï¼‰
    volumes:
      - ./code:/home/code   # å°‡å®¹å™¨ä¸­çš„å°ˆæ¡ˆç›®éŒ„å°æ‡‰åˆ°æœ¬æ©Ÿ ./code è³‡æ–™å¤¾
    expose:
      - "8080"               # å° nginx-proxy é–‹æ”¾å…§éƒ¨ portï¼Œä¸å°å¤–ç›´æ¥é–‹æ”¾


# dev_tools/
# â””â”€â”€ code-server-ssl/
#     â”œâ”€â”€ docker-compose.yml
#     â”œâ”€â”€ code/        â† å­˜æ”¾ä½ é–‹ç™¼çš„ç¨‹å¼æˆ–è³‡æ–™
#     â”œâ”€â”€ certs/       â† è‡ªå‹•ç”¢ç”Ÿ SSL æ†‘è­‰
#     â”œâ”€â”€ html/        â† Nginx é è¨­é é¢
#     â””â”€â”€ vhost.d/     â† æ¯å€‹è™›æ“¬ä¸»æ©Ÿçš„è¨­å®š

# âœ… è§£æ³•ï¼šç”¨ nginx-proxy + letsencrypt-nginx-proxy-companion æ­é… code-server
# é€™æ˜¯æ¥­ç•Œå¸¸ç”¨çš„ä¸€çµ„ Docker å¥—ä»¶çµ„åˆï¼Œå¯é”æˆä½ è¦çš„å…¨è‡ªå‹• HTTPS proxyã€‚